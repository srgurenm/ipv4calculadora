<!DOCTYPE html>
<!--2.0.8-->


<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subnetting Pro 2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: { 500: '#0ea5e9', 600: '#0284c7' },
                        dark: { 800: '#1e293b', 900: '#0f172a' }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .binary-cell { min-width: 35px; flex: 1; }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-dark-900 dark:text-gray-100 min-h-screen flex flex-col">

    <nav class="fixed top-0 w-full z-50 glass border-b border-gray-800 p-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold text-primary-500">Subnetting Pro 2.0</h1>
            <button id="darkModeToggle" class="p-2 bg-gray-800 rounded-full text-yellow-400">
                <i data-lucide="sun"></i>
            </button>
        </div>
    </nav>

    <main class="pt-24 pb-12 px-4 max-w-7xl mx-auto w-full grid grid-cols-1 lg:grid-cols-12 gap-8">
        <div class="lg:col-span-4 space-y-6">
            <div class="bg-white dark:bg-dark-800 p-6 rounded-2xl shadow-xl border border-gray-700">
                <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    <i data-lucide="sliders" class="text-primary-500"></i> Configuración
                </h2>
                <div class="space-y-4">
                    <div>
                        <label class="text-xs font-bold text-gray-400 uppercase">IP Base</label>
                        <input type="text" id="ipBase" value="10.50.0.0" class="w-full bg-gray-900 border border-gray-700 p-3 rounded-xl font-mono text-sm outline-none focus:ring-2 focus:ring-primary-500">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-400 uppercase">Clase Inicial</label>
                        <select id="clase" class="w-full bg-gray-900 border border-gray-700 p-3 rounded-xl text-sm outline-none cursor-pointer">
                            <option value="8">Clase A (/8)</option>
                            <option value="16" selected>Clase B (/16)</option>
                            <option value="24">Clase C (/24)</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs font-bold text-gray-400 uppercase">Subredes</label>
                            <input type="number" id="numSubnets" value="30" class="w-full bg-gray-900 border border-gray-700 p-3 rounded-xl font-mono text-sm">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-400 uppercase">Hosts</label>
                            <input type="number" id="hostsPerSubnet" value="1500" class="w-full bg-gray-900 border border-gray-700 p-3 rounded-xl font-mono text-sm">
                        </div>
                    </div>
                    <button id="calcBtn" class="w-full bg-primary-500 hover:bg-primary-600 text-white font-bold py-3 rounded-xl transition-all shadow-lg shadow-primary-500/20">
                        Calcular Ahora
                    </button>
                </div>
            </div>

            <div id="resultSummaryCard" class="bg-white dark:bg-dark-800 p-6 rounded-2xl border border-gray-700 hidden">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="bg-emerald-900/20 p-3 rounded-xl border border-emerald-800">
                        <span class="text-[10px] uppercase text-emerald-400 block">Salto</span>
                        <span id="valNetworkJump" class="text-xl font-bold text-emerald-500">-</span>
                    </div>
                    <div class="bg-indigo-900/20 p-3 rounded-xl border border-indigo-800">
                        <span class="text-[10px] uppercase text-indigo-400 block">Hosts Útiles</span>
                        <span id="valMaxHosts" class="text-xl font-bold text-indigo-500">-</span>
                    </div>
                </div>
                <div class="bg-primary-900/20 p-4 rounded-xl border border-primary-800">
                    <span class="text-[10px] uppercase text-primary-400 block">Máscara Final</span>
                    <span id="valResultMask" class="text-lg font-mono font-bold text-primary-500">-</span>
                </div>
            </div>
        </div>

        <div class="lg:col-span-8 space-y-6">
            <div id="binaryCard" class="bg-white dark:bg-dark-800 rounded-2xl border border-gray-700 overflow-hidden hidden">
                <div class="p-4 border-b border-gray-700 bg-gray-800/50 flex justify-between">
                    <span class="font-semibold text-sm">Análisis Binario (Máscara /21)</span>
                    <div class="flex gap-4 text-[9px] uppercase font-bold">
                        <span class="text-gray-500">■ Red</span>
                        <span class="text-primary-500">■ Subred</span>
                        <span class="text-amber-500">■ Host</span>
                    </div>
                </div>
                <div class="p-4 overflow-x-auto">
                    <div class="flex flex-col min-w-[900px]">
                        <div id="powersRow" class="flex text-[9px] text-gray-500 mb-1"></div>
                        <div id="notationRow" class="flex text-[8px] text-gray-400 mb-2"></div>
                        <div id="binaryRow" class="flex gap-px"></div>
                    </div>
                </div>
            </div>

            <div id="tableCard" class="bg-white dark:bg-dark-800 rounded-2xl border border-gray-700 overflow-hidden hidden">
                <div class="p-4 border-b border-gray-700 bg-gray-800/50">
                    <h3 class="font-semibold text-sm">Tabla de Direccionamiento</h3>
                </div>
                <div class="overflow-auto max-h-[500px]">
                    <table class="w-full text-left text-xs">
                        <thead class="bg-gray-900 sticky top-0">
                            <tr>
                                <th class="p-4 uppercase text-gray-500">#</th>
                                <th class="p-4 uppercase text-gray-500">Subred ID</th>
                                <th class="p-4 uppercase text-gray-500">Rango Útil</th>
                                <th class="p-4 uppercase text-gray-500">Broadcast</th>
                            </tr>
                        </thead>
                        <tbody id="tbody" class="divide-y divide-gray-800"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script>
        const IPService = {
            toLong: (ip) => ip.split('.').reduce((acc, octet) => (acc << 8) + parseInt(octet, 10), 0) >>> 0,
            fromLong: (long) => [24, 16, 8, 0].map(s => (long >>> s) & 0xFF).join('.'),
            calculateMask: (cidr) => {
                let mask = [];
                for(let i=0; i<4; i++) {
                    let bits = Math.min(8, Math.max(0, cidr - (i*8)));
                    mask.push(bits === 0 ? 0 : 256 - Math.pow(2, 8-bits));
                }
                return mask.join('.');
            }
        };

        class SubnettingUI {
            constructor() {
                this.init();
            }

            init() {
                lucide.createIcons();
                document.getElementById('calcBtn').onclick = () => this.calculate();
            }

            calculate() {
                const ip = document.getElementById('ipBase').value;
                const baseCidr = parseInt(document.getElementById('clase').value);
                const subnetsReq = parseInt(document.getElementById('numSubnets').value);
                const hostsReq = parseInt(document.getElementById('hostsPerSubnet').value);

                const bitsSub = Math.ceil(Math.log2(subnetsReq));
                const bitsHost = Math.ceil(Math.log2(hostsReq + 2));
                
                // Cálculo de Máscara: /16 (Base) + 5 (Subred) = /21. 
                // Verificamos que queden 11 bits para hosts (32-21=11). 
                let finalCidr = baseCidr + bitsSub;
                if ((32 - finalCidr) < bitsHost) finalCidr = 32 - bitsHost;

                this.render(baseCidr, bitsSub, finalCidr, IPService.toLong(ip), subnetsReq);
            }

            render(base, sub, target, ipLong, qty) {
                const blockSize = Math.pow(2, 32 - target);
                document.getElementById('valResultMask').textContent = `/${target} (${IPService.calculateMask(target)})`;
                document.getElementById('valMaxHosts').textContent = (blockSize - 2).toLocaleString();
                document.getElementById('valNetworkJump').textContent = Math.pow(2, 8 - (target % 8 || 8));

                document.getElementById('resultSummaryCard').classList.remove('hidden');
                document.getElementById('binaryCard').classList.remove('hidden');
                document.getElementById('tableCard').classList.remove('hidden');

                this.renderBinary(base, sub, target);
                this.renderTable(ipLong, blockSize, qty);
            }

            renderBinary(base, sub, target) {
                const pRow = document.getElementById('powersRow');
                const nRow = document.getElementById('notationRow');
                const bRow = document.getElementById('binaryRow');
                pRow.innerHTML = ''; nRow.innerHTML = ''; bRow.innerHTML = '';

                // Mostramos 3 octetos (bits 8 al 31)
                for (let i = 23; i >= 0; i--) {
                    const pos = 32 - i;
                    const isOctet = (i === 15 || i === 7);
                    
                    // Colores corregidos
                    let color = "bg-amber-500/20 text-amber-500"; // Host (0s)
                    if (pos <= base) color = "bg-gray-700 text-gray-400"; // Red Base
                    else if (pos <= (base + sub)) color = "bg-primary-500 text-white"; // Subred Prestada
                    else if (pos <= target) color = "bg-primary-800 text-primary-300"; // Bits extra por host requirement

                    const cellBase = `binary-cell text-center p-1 border-r border-dark-900`;
                    
                    pRow.innerHTML += `<div class="${cellBase}">${Math.pow(2, i).toLocaleString()}</div>`;
                    nRow.innerHTML += `<div class="${cellBase}">2^${i}</div>`;
                    bRow.innerHTML += `<div class="${cellBase} ${color} font-bold py-2">${pos <= target ? '1' : '0'}</div>`;
                }
            }

            renderTable(ip, block, qty) {
                const tbody = document.getElementById('tbody');
                tbody.innerHTML = '';
                for(let i=0; i < Math.min(qty, 100); i++) {
                    const start = (ip + (i * block)) >>> 0;
                    const end = (start + block - 1) >>> 0;
                    tbody.innerHTML += `<tr><td class="p-4">${i+1}</td><td class="p-4 font-bold text-primary-500">${IPService.fromLong(start)}</td><td class="p-4">${IPService.fromLong(start+1)} - ${IPService.fromLong(end-1)}</td><td class="p-4 text-gray-500">${IPService.fromLong(end)}</td></tr>`;
                }
            }
        }

        window.App = new SubnettingUI();
    </script>
</body>
</html>
